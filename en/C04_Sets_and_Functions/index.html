<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><link href=../C03_Logic/ rel=prev><link href=../C05_Elementary_Number_Theory/ rel=next><link rel=icon href=../../assets/images/favicon.png><meta name=generator content="mkdocs-1.6.0, mkdocs-material-9.5.31"><title>Sets and Functions - MIL</title><link rel=stylesheet href=../../assets/stylesheets/main.3cba04c6.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link rel=stylesheet href=../../assets/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=green data-md-color-accent=light-green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#sets-and-functions class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=MIL class="md-header__button md-logo" aria-label=MIL data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> MIL </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> Sets and Functions </span> </div> </div> </div> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/hmyuuu/MIL-zh-demo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> MIL-zh-demo </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../ class=md-tabs__link> 目录 </a> </li> <li class=md-tabs__item> <a href=../C01_Introduction/ class=md-tabs__link> Introduction </a> </li> <li class=md-tabs__item> <a href=../C02_Basics/ class=md-tabs__link> Basics </a> </li> <li class=md-tabs__item> <a href=../C03_Logic/ class=md-tabs__link> Logic </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=./ class=md-tabs__link> Sets and Functions </a> </li> <li class=md-tabs__item> <a href=../C05_Elementary_Number_Theory/ class=md-tabs__link> Elementary Number Theory </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=MIL class="md-nav__button md-logo" aria-label=MIL data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg> </a> MIL </label> <div class=md-nav__source> <a href=https://github.com/hmyuuu/MIL-zh-demo title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 6.6.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg> </div> <div class=md-source__repository> MIL-zh-demo </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> 目录 </span> </a> </li> <li class=md-nav__item> <a href=../C01_Introduction/ class=md-nav__link> <span class=md-ellipsis> Introduction </span> </a> </li> <li class=md-nav__item> <a href=../C02_Basics/ class=md-nav__link> <span class=md-ellipsis> Basics </span> </a> </li> <li class=md-nav__item> <a href=../C03_Logic/ class=md-nav__link> <span class=md-ellipsis> Logic </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> <span class=md-ellipsis> Sets and Functions </span> <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> <span class=md-ellipsis> Sets and Functions </span> </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#sets class=md-nav__link> <span class=md-ellipsis> Sets </span> </a> </li> <li class=md-nav__item> <a href=#functions class=md-nav__link> <span class=md-ellipsis> Functions </span> </a> </li> <li class=md-nav__item> <a href=#the-schroder-bernstein-theorem class=md-nav__link> <span class=md-ellipsis> The Schröder-Bernstein Theorem </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../C05_Elementary_Number_Theory/ class=md-nav__link> <span class=md-ellipsis> Elementary Number Theory </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#sets class=md-nav__link> <span class=md-ellipsis> Sets </span> </a> </li> <li class=md-nav__item> <a href=#functions class=md-nav__link> <span class=md-ellipsis> Functions </span> </a> </li> <li class=md-nav__item> <a href=#the-schroder-bernstein-theorem class=md-nav__link> <span class=md-ellipsis> The Schröder-Bernstein Theorem </span> </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=sets-and-functions>Sets and Functions<a class=headerlink href=#sets-and-functions title="Permanent link">&para;</a></h1> <p>The vocabulary of sets, relations, and functions provides a uniform language for carrying out constructions in all the branches of mathematics. Since functions and relations can be defined in terms of sets, axiomatic set theory can be used as a foundation for mathematics.</p> <p>Lean's foundation is based instead on the primitive notion of a <em>type</em>, and it includes ways of defining functions between types. Every expression in Lean has a type: there are natural numbers, real numbers, functions from reals to reals, groups, vector spaces, and so on. Some expressions <em>are</em> types, which is to say, their type is <code>Type</code>. Lean and Mathlib provide ways of defining new types, and ways of defining objects of those types.</p> <p>Conceptually, you can think of a type as just a set of objects. Requiring every object to have a type has some advantages. For example, it makes it possible to overload notation like <code>+</code>, and it sometimes makes input less verbose because Lean can infer a lot of information from an object's type. The type system also enables Lean to flag errors when you apply a function to the wrong number of arguments, or apply a function to arguments of the wrong type.</p> <p>Lean's library does define elementary set-theoretic notions. In contrast to set theory, in Lean a set is always a set of objects of some type, such as a set of natural numbers or a set of functions from real numbers to real numbers. The distinction between types and sets takes some getting used to, but this chapter will take you through the essentials.</p> <h2 id=sets>Sets<a class=headerlink href=#sets title="Permanent link">&para;</a></h2> <p>.. index:: set operations</p> <p>If <code>α</code> is any type, the type <code>Set α</code> consists of sets of elements of <code>α</code>. This type supports the usual set-theoretic operations and relations. For example, <code>s ⊆ t</code> says that <code>s</code> is a subset of <code>t</code>, <code>s ∩ t</code> denotes the intersection of <code>s</code> and <code>t</code>, and <code>s ∪ t</code> denotes their union. The subset relation can be typed with <code>\ss</code> or <code>\sub</code>, intersection can be typed with <code>\i</code> or <code>\cap</code>, and union can be typed with <code>\un</code> or <code>\cup</code>. The library also defines the set <code>univ</code>, which consists of all the elements of type <code>α</code>, and the empty set, <code>∅</code>, which can be typed as <code>\empty</code>. Given <code>x : α</code> and <code>s : Set α</code>, the expression <code>x ∈ s</code> says that <code>x</code> is a member of <code>s</code>. Theorems that mention set membership often include <code>mem</code> in their name. The expression <code>x ∉ s</code> abbreviates <code>¬ x ∈ s</code>. You can type <code>∈</code> as <code>\in</code> or <code>\mem</code> and <code>∉</code> as <code>\notin</code>.</p> <p>.. index:: simp, tactics ; simp</p> <p>One way to prove things about sets is to use <code>rw</code> or the simplifier to expand the definitions. In the second example below, we use <code>simp only</code> to tell the simplifier to use only the list of identities we give it, and not its full database of identities. Unlike <code>rw</code>, <code>simp</code> can perform simplifications inside a universal or existential quantifier. If you step through the proof, you can see the effects of these commands.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>α</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>)</span>
<span class=kn>open</span><span class=w> </span><span class=n>Set</span>

<span class=c1>-- EXAMPLES:</span>
<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>subset_def</span><span class=o>,</span><span class=w> </span><span class=n>inter_def</span><span class=o>,</span><span class=w> </span><span class=n>inter_def</span><span class=o>]</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>subset_def</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>h</span>
<span class=w>  </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>mem_setOf</span><span class=o>]</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>h</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>subset_def</span><span class=o>,</span><span class=w> </span><span class=n>mem_inter_iff</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=bp>*</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>h</span><span class=w> </span><span class=n>_</span><span class=w> </span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
</code></pre></div> <p>In this example, we open the <code>set</code> namespace to have access to the shorter names for the theorems. But, in fact, we can delete the calls to <code>rw</code> and <code>simp</code> entirely:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xsu</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>h</span><span class=w> </span><span class=n>xsu</span><span class=bp>.</span><span class=mi>1</span><span class=o>,</span><span class=w> </span><span class=n>xsu</span><span class=bp>.</span><span class=mi>2</span><span class=o>⟩</span>
</code></pre></div> <p>What is going on here is known as <em>definitional reduction</em>: to make sense of the <code>intro</code> command and the anonymous constructors Lean is forced to expand the definitions. The following example also illustrate the phenomenon:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=k>fun</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=o>⟨</span><span class=n>h</span><span class=w> </span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
</code></pre></div> <p>To deal with unions, we can use <code>Set.union_def</code> and <code>Set.mem_union</code>. Since <code>x ∈ s ∪ t</code> unfolds to <code>x ∈ s ∨ x ∈ t</code>, we can also use the <code>cases</code> tactic to force a definitional reduction.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=o>(</span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>hx</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>xs</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>hx</span><span class=bp>.</span><span class=mi>1</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>xtu</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>hx</span><span class=bp>.</span><span class=mi>2</span>
<span class=w>  </span><span class=n>rcases</span><span class=w> </span><span class=n>xtu</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>xt</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>xu</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>left</span>
<span class=w>    </span><span class=k>show</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span>
<span class=w>    </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span>
<span class=w>  </span><span class=bp>.</span><span class=w> </span><span class=n>right</span>
<span class=w>    </span><span class=k>show</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span>
<span class=w>    </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
</code></pre></div> <p>Since intersection binds tighter than union, the use of parentheses in the expression <code>(s ∩ t) ∪ (s ∩ u)</code> is unnecessary, but they make the meaning of the expression clearer. The following is a shorter proof of the same fact:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=o>(</span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>left</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span>
<span class=w>  </span><span class=bp>.</span><span class=w> </span><span class=n>right</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩</span>
</code></pre></div> <p>As an exercise, try proving the other inclusion:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=o>(</span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=c>/-</span><span class=cm> EXAMPLES:</span>
<span class=cm>  sorry</span>
<span class=cm>SOLUTIONS: -/</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>(⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xu</span><span class=o>⟩)</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=n>xs</span><span class=bp>;</span><span class=w> </span><span class=n>left</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=n>xt</span>
<span class=w>  </span><span class=bp>.</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=n>xs</span><span class=bp>;</span><span class=w> </span><span class=n>right</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=n>xu</span>
</code></pre></div> <p>It might help to know that when using <code>rintro</code>, sometimes we need to use parentheses around a disjunctive pattern <code>h1 | h2</code> to get Lean to parse it correctly.</p> <p>The library also defines set difference, <code>s \ t</code>, where the backslash is a special unicode character entered as <code>\\</code>. The expression <code>x ∈ s \ t</code> expands to <code>x ∈ s ∧ x ∉ t</code>. (The <code>∉</code> can be entered as <code>\notin</code>.) It can be rewritten manually using <code>Set.diff_eq</code> and <code>dsimp</code> or <code>Set.mem_diff</code>, but the following two proofs of the same inclusion show how to avoid using them.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=o>(</span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xstu</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>xs</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>xstu</span><span class=bp>.</span><span class=mi>1</span><span class=bp>.</span><span class=mi>1</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>xnt</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>xstu</span><span class=bp>.</span><span class=mi>1</span><span class=bp>.</span><span class=mi>2</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>xnu</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>xstu</span><span class=bp>.</span><span class=mi>2</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>xtu</span>
<span class=w>  </span><span class=c1>-- x ∈ t ∨ x ∈ u</span>
<span class=w>  </span><span class=n>rcases</span><span class=w> </span><span class=n>xtu</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>xt</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>xu</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>False</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=n>xnt</span><span class=w> </span><span class=n>xt</span>
<span class=w>  </span><span class=bp>.</span><span class=w> </span><span class=k>show</span><span class=w> </span><span class=n>False</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=n>xnu</span><span class=w> </span><span class=n>xu</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=o>(</span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xnt</span><span class=o>⟩,</span><span class=w> </span><span class=n>xnu</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>use</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=o>(</span><span class=n>xt</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>xu</span><span class=o>)</span><span class=w> </span><span class=bp>&lt;;&gt;</span><span class=w> </span><span class=n>contradiction</span>
</code></pre></div> <p>As an exercise, prove the reverse inclusion:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=o>(</span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=c>/-</span><span class=cm> EXAMPLES:</span>
<span class=cm>  sorry</span>
<span class=cm>SOLUTIONS: -/</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xntu</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=n>use</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>intro</span><span class=w> </span><span class=n>xt</span>
<span class=w>    </span><span class=n>exact</span><span class=w> </span><span class=n>xntu</span><span class=w> </span><span class=o>(</span><span class=n>Or.inl</span><span class=w> </span><span class=n>xt</span><span class=o>)</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>xu</span>
<span class=w>  </span><span class=n>apply</span><span class=w> </span><span class=n>xntu</span><span class=w> </span><span class=o>(</span><span class=n>Or.inr</span><span class=w> </span><span class=n>xu</span><span class=o>)</span>
</code></pre></div> <p>To prove that two sets are equal, it suffices to show that every element of one is an element of the other. This principle is known as "extensionality," and, unsurprisingly, the <code>ext</code> tactic is equipped to handle it.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>x</span>
<span class=w>  </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>mem_inter_iff</span><span class=o>]</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span>
<span class=w>  </span><span class=bp>.</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span>
</code></pre></div> <p>Once again, deleting the line <code>simp only [mem_inter_iff]</code> does not harm the proof. In fact, if you like inscrutable proof terms, the following one-line proof is for you:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=n>Set.ext</span><span class=w> </span><span class=k>fun</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=o>⟨</span><span class=k>fun</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩,</span><span class=w> </span><span class=k>fun</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩⟩</span>
</code></pre></div> <p>Here is an even shorter proof, using the simplifier:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span><span class=w> </span><span class=n>ext</span><span class=w> </span><span class=n>x</span><span class=bp>;</span><span class=w> </span><span class=n>simp</span><span class=w> </span><span class=o>[</span><span class=n>and_comm</span><span class=o>]</span>
</code></pre></div> <p>An alternative to using <code>ext</code> is to use the theorem <code>Subset.antisymm</code> which allows us to prove an equation <code>s = t</code> between sets by proving <code>s ⊆ t</code> and <code>t ⊆ s</code>.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>apply</span><span class=w> </span><span class=n>Subset.antisymm</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span>
<span class=w>  </span><span class=bp>.</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span><span class=bp>;</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span>
</code></pre></div> <p>Try finishing this proof term:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span>
<span class=w>    </span><span class=n>Subset.antisymm</span><span class=w> </span><span class=gr>sorry</span><span class=w> </span><span class=gr>sorry</span>
<span class=w>    </span><span class=n>Subset.antisymm</span>
<span class=w>    </span><span class=o>(</span><span class=k>fun</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩)</span><span class=w> </span><span class=k>fun</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>⟨</span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>⟩</span>
</code></pre></div> <p>Remember that you can replace <code>sorry</code> by an underscore, and when you hover over it, Lean will show you what it expects at that point.</p> <p>Here are some set-theoretic identities you might enjoy proving:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>When it comes to representing sets, here is what is going on underneath the hood. In type theory, a <em>property</em> or <em>predicate</em> on a type <code>α</code> is just a function <code>P : α → Prop</code>. This makes sense: given <code>a : α</code>, <code>P a</code> is just the proposition that <code>P</code> holds of <code>a</code>. In the library, <code>Set α</code> is defined to be <code>α → Prop</code> and <code>x ∈ s</code> is defined to be <code>s x</code>. In other words, sets are really properties, treated as objects.</p> <p>The library also defines set-builder notation. The expression <code>{ y | P y }</code> unfolds to <code>(fun y ↦ P y)</code>, so <code>x ∈ { y | P y }</code> reduces to <code>P x</code>. So we can turn the property of being even into the set of even numbers:</p> <div class=highlight><pre><span></span><code><span class=kd>def</span><span class=w> </span><span class=n>evens</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>ℕ</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=o>{</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>Even</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>}</span>

<span class=kd>def</span><span class=w> </span><span class=n>odds</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>ℕ</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=o>{</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>}</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>evens</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>odds</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>univ</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>evens</span><span class=o>,</span><span class=w> </span><span class=n>odds</span><span class=o>]</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>n</span>
<span class=w>  </span><span class=n>simp</span>
<span class=w>  </span><span class=n>apply</span><span class=w> </span><span class=n>Classical.em</span>
</code></pre></div> <p>You should step through this proof and make sure you understand what is going on. Try deleting the line <code>rw [evens, odds]</code> and confirm that the proof still works.</p> <p>In fact, set-builder notation is used to define</p> <ul> <li><code>s ∩ t</code> as <code>{x | x ∈ s ∧ x ∈ t}</code>,</li> <li><code>s ∪ t</code> as <code>{x | x ∈ s ∨ x ∈ t}</code>,</li> <li><code>∅</code> as <code>{x | False}</code>, and</li> <li><code>univ</code> as <code>{x | True}</code>.</li> </ul> <p>We often need to indicate the type of <code>∅</code> and <code>univ</code> explicitly, because Lean has trouble guessing which ones we mean. The following examples show how Lean unfolds the last two definitions when needed. In the second one, <code>trivial</code> is the canonical proof of <code>True</code> in the library.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>x</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=o>(</span><span class=bp>∅</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>ℕ</span><span class=o>))</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>False</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=n>h</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>x</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=o>(</span><span class=n>univ</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=n>trivial</span>
</code></pre></div> <p>As an exercise, prove the following inclusion. Use <code>intro n</code> to unfold the definition of subset, and use the simplifier to reduce the set-theoretic constructions to logic. We also recommend using the theorems <code>Nat.Prime.eq_two_or_odd</code> and <code>Nat.even_iff</code>.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>Nat.Prime</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>&gt;</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>Be careful: it is somewhat confusing that the library has multiple versions of the predicate <code>Prime</code>. The most general one makes sense in any commutative monoid with a zero element. The predicate <code>Nat.Prime</code> is specific to the natural numbers. Fortunately, there is a theorem that says that in the specific case, the two notions agree, so you can always rewrite one to the other.</p> <div class=highlight><pre><span></span><code><span class=k>#print</span><span class=w> </span><span class=n>Prime</span>

<span class=k>#print</span><span class=w> </span><span class=n>Nat.Prime</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>n</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>↔</span><span class=w> </span><span class=n>Nat.Prime</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=n>Nat.prime_iff.symm</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>n</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>n</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Nat.Prime</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>Nat.prime_iff</span><span class=o>]</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=n>h</span>
</code></pre></div> <p>.. index:: rwa, tactics ; rwa</p> <p>The <code>rwa</code> tactic follows a rewrite with the assumption tactic.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>n</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>n</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Nat.Prime</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rwa</span><span class=w> </span><span class=o>[</span><span class=n>Nat.prime_iff</span><span class=o>]</span>
</code></pre></div> <p>-- BOTH: end</p> <p>.. index:: bounded quantifiers</p> <p>Lean introduces the notation <code>∀ x ∈ s, ...</code>, "for every <code>x</code> in <code>s</code> .," as an abbreviation for <code>∀ x, x ∈ s → ...</code>. It also introduces the notation <code>∃ x ∈ s, ...,</code> "there exists an <code>x</code> in <code>s</code> such that .." These are sometimes known as <em>bounded quantifiers</em>, because the construction serves to restrict their significance to the set <code>s</code>. As a result, theorems in the library that make use of them often contain <code>ball</code> or <code>bex</code> in the name. The theorem <code>bex_def</code> asserts that <code>∃ x ∈ s, ...</code> is equivalent to <code>∃ x, x ∈ s ∧ ...,</code> but when they are used with <code>rintro</code>, <code>use</code>, and anonymous constructors, these two expressions behave roughly the same. As a result, we usually don't need to use <code>bex_def</code> to transform them explicitly. Here is are some examples of how they are used:</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>ℕ</span><span class=o>)</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h₀</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h₁</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∧</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>apply</span><span class=w> </span><span class=n>h₀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=n>apply</span><span class=w> </span><span class=n>h₁</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xs</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∧</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rcases</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=o>⟨</span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>_</span><span class=o>,</span><span class=w> </span><span class=n>prime_x</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>use</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xs</span>
</code></pre></div> <p>See if you can prove these slight variations:</p> <div class=highlight><pre><span></span><code><span class=kn>section</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>ssubt</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=o>)</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h₀</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>t</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h₁</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>t</span><span class=o>,</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∧</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Even</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∧</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>t</span><span class=o>,</span><span class=w> </span><span class=n>Prime</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>end</span>
</code></pre></div> <p>Indexed unions and intersections are another important set-theoretic construction. We can model a sequence <span class=arithmatex>\(A_0, A_1, A_2, \ldots\)</span> of sets of elements of <code>α</code> as a function <code>A : ℕ → Set α</code>, in which case <code>⋃ i, A i</code> denotes their union, and <code>⋂ i, A i</code> denotes their intersection. There is nothing special about the natural numbers here, so <code>ℕ</code> can be replaced by any type <code>I</code> used to index the sets. The following illustrates their use.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>α</span><span class=w> </span><span class=n>I</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>A</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>I</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>)</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>)</span>

<span class=kn>open</span><span class=w> </span><span class=n>Set</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>x</span>
<span class=w>  </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>mem_inter_iff</span><span class=o>,</span><span class=w> </span><span class=n>mem_iUnion</span><span class=o>]</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=o>⟨</span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>xAi</span><span class=o>⟩⟩</span>
<span class=w>    </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>xAi</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>xAi</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>⟩</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=o>⟨</span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>xAi</span><span class=o>⟩⟩</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>(</span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>x</span>
<span class=w>  </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>mem_inter_iff</span><span class=o>,</span><span class=w> </span><span class=n>mem_iInter</span><span class=o>]</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>intro</span><span class=w> </span><span class=n>h</span>
<span class=w>    </span><span class=n>constructor</span>
<span class=w>    </span><span class=bp>·</span><span class=w> </span><span class=n>intro</span><span class=w> </span><span class=n>i</span>
<span class=w>      </span><span class=n>exact</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=bp>.</span><span class=mi>1</span>
<span class=w>    </span><span class=n>intro</span><span class=w> </span><span class=n>i</span>
<span class=w>    </span><span class=n>exact</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=bp>.</span><span class=mi>2</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>h1</span><span class=o>,</span><span class=w> </span><span class=n>h2</span><span class=o>⟩</span><span class=w> </span><span class=n>i</span>
<span class=w>  </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>exact</span><span class=w> </span><span class=n>h1</span><span class=w> </span><span class=n>i</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=n>h2</span><span class=w> </span><span class=n>i</span>
</code></pre></div> <p>Parentheses are often needed with an indexed union or intersection because, as with the quantifiers, the scope of the bound variable extends as far as it can.</p> <p>Try proving the following identity. One direction requires classical logic! We recommend using <code>by_cases xs : x ∈ s</code> at an appropriate point in the proof.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>Mathlib also has bounded unions and intersections, which are analogous to the bounded quantifiers. You can unpack their meaning with <code>mem_iUnion₂</code> and <code>mem_iInter₂</code>. As the following examples show, Lean's simplifier carries out these replacements as well.</p> <div class=highlight><pre><span></span><code><span class=kd>def</span><span class=w> </span><span class=n>primes</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>ℕ</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>Nat.Prime</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>}</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=bp>⋃</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>primes</span><span class=o>,</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>^</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=bp>∣</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>})</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>primes</span><span class=o>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>^</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=bp>∣</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>mem_iUnion₂</span><span class=o>]</span>
<span class=w>  </span><span class=n>simp</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=bp>⋃</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>primes</span><span class=o>,</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>^</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=bp>∣</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>})</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>primes</span><span class=o>,</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>^</span><span class=w> </span><span class=mi>2</span><span class=w> </span><span class=bp>∣</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span>
<span class=w>  </span><span class=n>simp</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=bp>⋂</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>primes</span><span class=o>,</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=bp>¬</span><span class=n>p</span><span class=w> </span><span class=bp>∣</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>})</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span>
<span class=w>  </span><span class=n>contrapose</span><span class=bp>!</span>
<span class=w>  </span><span class=n>simp</span>
<span class=w>  </span><span class=n>apply</span><span class=w> </span><span class=n>Nat.exists_prime_and_dvd</span>
</code></pre></div> <p>Try solving the following example, which is similar. If you start typing <code>eq_univ</code>, tab completion will tell you that <code>apply eq_univ_of_forall</code> is a good way to start the proof. We also recommend using the theorem <code>Nat.exists_infinite_primes</code>.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=bp>⋃</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>primes</span><span class=o>,</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>≤</span><span class=w> </span><span class=n>p</span><span class=w> </span><span class=o>})</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>univ</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>Give a collection of sets, <code>s : Set (Set α)</code>, their union, <code>⋃₀ s</code>, has type <code>Set α</code> and is defined as <code>{x | ∃ t ∈ s, x ∈ t}</code>. Similarly, their intersection, <code>⋂₀ s</code>, is defined as <code>{x | ∀ t ∈ s, x ∈ t}</code>. These operations are called <code>sUnion</code> and <code>sInter</code>, respectively. The following examples show their relationship to bounded union and intersection.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>α</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=o>(</span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>))</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>⋃₀</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>x</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>mem_iUnion₂</span><span class=o>]</span>
<span class=w>  </span><span class=n>simp</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>⋂₀</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>x</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>mem_iInter₂</span><span class=o>]</span>
<span class=w>  </span><span class=n>rfl</span>
</code></pre></div> <p>In the library, these identities are called <code>sUnion_eq_biUnion</code> and <code>sInter_eq_biInter</code>.</p> <h2 id=functions>Functions<a class=headerlink href=#functions title="Permanent link">&para;</a></h2> <p>If <code>f : α → β</code> is a function and <code>p</code> is a set of elements of type <code>β</code>, the library defines <code>preimage f p</code>, written <code>f ⁻¹' p</code>, to be <code>{x | f x ∈ p}</code>. The expression <code>x ∈ f ⁻¹' p</code> reduces to <code>f x ∈ p</code>. This is often convenient, as in the following example:</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>α</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>)</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>)</span>
<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>u</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>β</span><span class=o>)</span>

<span class=kn>open</span><span class=w> </span><span class=n>Function</span>
<span class=kn>open</span><span class=w> </span><span class=n>Set</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>u</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>v</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span>
<span class=w>  </span><span class=n>rfl</span>
</code></pre></div> <p>If <code>s</code> is a set of elements of type <code>α</code>, the library also defines <code>image f s</code>, written <code>f '' s</code>, to be <code>{y | ∃ x, x ∈ s ∧ f x = y}</code>. So a hypothesis <code>y ∈ f '' s</code> decomposes to a triple <code>⟨x, xs, xeq⟩</code> with <code>x : α</code> satisfying the hypotheses <code>xs : x ∈ s</code> and <code>xeq : f x = y</code>. The <code>rfl</code> tag in the <code>rintro</code> tactic (see :numref:<code>the_existential_quantifier</code>) was made precisely for this sort of situation.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>y</span><span class=bp>;</span><span class=w> </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>rfl</span><span class=o>⟩</span>
<span class=w>    </span><span class=bp>·</span><span class=w> </span><span class=n>left</span>
<span class=w>      </span><span class=n>use</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xs</span>
<span class=w>    </span><span class=n>right</span>
<span class=w>    </span><span class=n>use</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xt</span>
<span class=w>  </span><span class=n>rintro</span><span class=w> </span><span class=o>(⟨</span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xs</span><span class=o>,</span><span class=w> </span><span class=n>rfl</span><span class=o>⟩</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=o>⟨</span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xt</span><span class=o>,</span><span class=w> </span><span class=n>rfl</span><span class=o>⟩)</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>use</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>Or.inl</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=n>use</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>Or.inr</span><span class=w> </span><span class=n>xt</span>
</code></pre></div> <p>Notice also that the <code>use</code> tactic applies <code>rfl</code> to close goals when it can.</p> <p>Here is another example:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xs</span>
<span class=w>  </span><span class=k>show</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span>
<span class=w>  </span><span class=n>use</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xs</span>
</code></pre></div> <p>We can replace the line <code>use x, xs</code> by <code>apply mem_image_of_mem f xs</code> if we want to use a theorem specifically designed for that purpose. But knowing that the image is defined in terms of an existential quantifier is often convenient.</p> <p>The following equivalence is a good exercise:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=bp>↔</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>It shows that <code>image f</code> and <code>preimage f</code> are an instance of what is known as a <em>Galois connection</em> between <code>Set α</code> and <code>Set β</code>, each partially ordered by the subset relation. In the library, this equivalence is named <code>image_subset_iff</code>. In practice, the right-hand side is often the more useful representation, because <code>y ∈ f ⁻¹' t</code> unfolds to <code>f y ∈ t</code> whereas working with <code>x ∈ f '' s</code> requires decomposing an existential quantifier.</p> <p>Here is a long list of set-theoretic identities for you to enjoy. You don't have to do all of them at once; do a few of them, and set the rest aside for a rainy day.</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Surjective</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>v</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>u</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>v</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>t</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>t</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>u</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>v</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>v</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>v</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∩</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>u</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>∪</span><span class=w> </span><span class=n>u</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>You can also try your hand at the next group of exercises, which characterize the behavior of images and preimages with respect to indexed unions and intersections. In the third exercise, the argument <code>i : I</code> is needed to guarantee that the index set is nonempty. To prove any of these, we recommend using <code>ext</code> or <code>intro</code> to unfold the meaning of an equation or inclusion between sets, and then calling <code>simp</code> to unpack the conditions for membership.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>I</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span><span class=w> </span><span class=o>(</span><span class=n>A</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>I</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>B</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>I</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>β</span><span class=o>)</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>(</span><span class=n>i</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>I</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>injf</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>⊆</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋃</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>i</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=bp>⋂</span><span class=w> </span><span class=n>i</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>⁻¹&#39;</span><span class=w> </span><span class=n>B</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>The library defines a predicate <code>InjOn f s</code> to say that <code>f</code> is injective on <code>s</code>. It is defined as follows:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>InjOn</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>s</span><span class=w> </span><span class=bp>↔</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>s</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=n>Iff.refl</span><span class=w> </span><span class=n>_</span>
</code></pre></div> <p>The statement <code>Injective f</code> is provably equivalent to <code>InjOn f univ</code>. Similarly, the library defines <code>range f</code> to be <code>{x | ∃y, f y = x}</code>, so <code>range f</code> is provably equal to <code>f '' univ</code>. This is a common theme in Mathlib: although many properties of functions are defined relative to their full domain, there are often relativized versions that restrict the statements to a subset of the domain type.</p> <p>Here is are some examples of <code>InjOn</code> and <code>range</code> in use:</p> <div class=highlight><pre><span></span><code><span class=kn>open</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>Real</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>InjOn</span><span class=w> </span><span class=n>log</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=n>xpos</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=n>ypos</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>e</span>
<span class=w>  </span><span class=k>calc</span>
<span class=w>    </span><span class=n>x</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>exp</span><span class=w> </span><span class=o>(</span><span class=n>log</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span><span class=w> </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>exp_log</span><span class=w> </span><span class=n>xpos</span><span class=o>]</span>
<span class=w>    </span><span class=n>_</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>exp</span><span class=w> </span><span class=o>(</span><span class=n>log</span><span class=w> </span><span class=n>y</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span><span class=w> </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>e</span><span class=o>]</span>
<span class=w>    </span><span class=n>_</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span><span class=w> </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>exp_log</span><span class=w> </span><span class=n>ypos</span><span class=o>]</span>


<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>range</span><span class=w> </span><span class=n>exp</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>&gt;</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>ext</span><span class=w> </span><span class=n>y</span><span class=bp>;</span><span class=w> </span><span class=n>constructor</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>rintro</span><span class=w> </span><span class=o>⟨</span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>rfl</span><span class=o>⟩</span>
<span class=w>    </span><span class=n>apply</span><span class=w> </span><span class=n>exp_pos</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>ypos</span>
<span class=w>  </span><span class=n>use</span><span class=w> </span><span class=n>log</span><span class=w> </span><span class=n>y</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>exp_log</span><span class=w> </span><span class=n>ypos</span><span class=o>]</span>
</code></pre></div> <p>Try proving these:</p> <div class=highlight><pre><span></span><code><span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>InjOn</span><span class=w> </span><span class=n>sqrt</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>≥</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>InjOn</span><span class=w> </span><span class=o>(</span><span class=k>fun</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>^</span><span class=w> </span><span class=mi>2</span><span class=o>)</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℝ</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>≥</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>sqrt</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>≥</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>≥</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=o>(</span><span class=n>range</span><span class=w> </span><span class=k>fun</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>↦</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>^</span><span class=w> </span><span class=mi>2</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℝ</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>≥</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=o>}</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>To define the inverse of a function <code>f : α → β</code>, we will use two new ingredients. First, we need to deal with the fact that an arbitrary type in Lean may be empty. To define the inverse to <code>f</code> at <code>y</code> when there is no <code>x</code> satisfying <code>f x = y</code>, we want to assign a default value in <code>α</code>. Adding the annotation <code>[Inhabited α]</code> as a variable is tantamount to assuming that <code>α</code> has a preferred element, which is denoted <code>default</code>. Second, in the case where there is more than one <code>x</code> such that <code>f x = y</code>, the inverse function needs to <em>choose</em> one of them. This requires an appeal to the <em>axiom of choice</em>. Lean allows various ways of accessing it; one convenient method is to use the classical <code>choose</code> operator, illustrated below.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>α</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span><span class=w> </span><span class=o>[</span><span class=n>Inhabited</span><span class=w> </span><span class=n>α</span><span class=o>]</span>

<span class=c1>-- EXAMPLES:</span>
<span class=k>#check</span><span class=w> </span><span class=o>(</span><span class=n>default</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=o>)</span>

<span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>P</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=kt>Prop</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>P</span><span class=w> </span><span class=n>x</span><span class=o>)</span>

<span class=k>#check</span><span class=w> </span><span class=n>Classical.choose</span><span class=w> </span><span class=n>h</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>P</span><span class=w> </span><span class=o>(</span><span class=n>Classical.choose</span><span class=w> </span><span class=n>h</span><span class=o>)</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=n>Classical.choose_spec</span><span class=w> </span><span class=n>h</span>
</code></pre></div> <p>Given <code>h : ∃ x, P x</code>, the value of <code>Classical.choose h</code> is some <code>x</code> satisfying <code>P x</code>. The theorem <code>Classical.choose_spec h</code> says that <code>Classical.choose h</code> meets this specification.</p> <p>With these in hand, we can define the inverse function as follows:</p> <div class=highlight><pre><span></span><code><span class=kd>noncomputable</span><span class=w> </span><span class=kn>section</span>

<span class=kn>open</span><span class=w> </span><span class=n>Classical</span>

<span class=kd>def</span><span class=w> </span><span class=n>inverse</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=k>fun</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=bp>↦</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=n>Classical.choose</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=n>default</span>

<span class=kd>theorem</span><span class=w> </span><span class=n>inverse_spec</span><span class=w> </span><span class=o>{</span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>}</span><span class=w> </span><span class=o>(</span><span class=n>y</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>β</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>y</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>(</span><span class=n>inverse</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>y</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>inverse</span><span class=o>,</span><span class=w> </span><span class=n>dif_pos</span><span class=w> </span><span class=n>h</span><span class=o>]</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=n>Classical.choose_spec</span><span class=w> </span><span class=n>h</span>
</code></pre></div> <p>The lines <code>noncomputable section</code> and <code>open Classical</code> are needed because we are using classical logic in an essential way. On input <code>y</code>, the function <code>inverse f</code> returns some value of <code>x</code> satisfying <code>f x = y</code> if there is one, and a default element of <code>α</code> otherwise. This is an instance of a <em>dependent if</em> construction, since in the positive case, the value returned, <code>Classical.choose h</code>, depends on the assumption <code>h</code>. The identity <code>dif_pos h</code> rewrites <code>if h : e then a else b</code> to <code>a</code> given <code>h : e</code>, and, similarly, <code>dif_neg h</code> rewrites it to <code>b</code> given <code>h : ¬ e</code>. There are also versions <code>if_pos</code> and <code>if_neg</code> that works for non-dependent if constructions and will be used in the next section. The theorem <code>inverse_spec</code> says that <code>inverse f</code> meets the first part of this specification.</p> <p>Don't worry if you do not fully understand how these work. The theorem <code>inverse_spec</code> alone should be enough to show that <code>inverse f</code> is a left inverse if and only if <code>f</code> is injective and a right inverse if and only if <code>f</code> is surjective. Look up the definition of <code>LeftInverse</code> and <code>RightInverse</code> by double-clicking or right-clicking on them in VS Code, or using the commands <code>#print LeftInverse</code> and <code>#print RightInverse</code>. Then try to prove the two theorems. They are tricky! It helps to do the proofs on paper before you start hacking through the details. You should be able to prove each of them with about a half-dozen short lines. If you are looking for an extra challenge, try to condense each proof to a single-line proof term.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>)</span>

<span class=kn>open</span><span class=w> </span><span class=n>Function</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>↔</span><span class=w> </span><span class=n>LeftInverse</span><span class=w> </span><span class=o>(</span><span class=n>inverse</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=gr>sorry</span>

<span class=kd>example</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Surjective</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=bp>↔</span><span class=w> </span><span class=n>RightInverse</span><span class=w> </span><span class=o>(</span><span class=n>inverse</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>We close this section with a type-theoretic statement of Cantor's famous theorem that there is no surjective function from a set to its power set. See if you can understand the proof, and then fill in the two lines that are missing.</p> <div class=highlight><pre><span></span><code><span class=kd>theorem</span><span class=w> </span><span class=n>Cantor</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∀</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span><span class=o>,</span><span class=w> </span><span class=bp>¬</span><span class=n>Surjective</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>surjf</span>
<span class=w>  </span><span class=k>let</span><span class=w> </span><span class=n>S</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=o>{</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>i</span><span class=w> </span><span class=o>}</span>
<span class=w>  </span><span class=n>rcases</span><span class=w> </span><span class=n>surjf</span><span class=w> </span><span class=n>S</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=o>⟨</span><span class=n>j</span><span class=o>,</span><span class=w> </span><span class=n>h</span><span class=o>⟩</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>h₁</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>    </span><span class=n>intro</span><span class=w> </span><span class=n>h&#39;</span>
<span class=w>    </span><span class=k>have</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span><span class=w> </span><span class=n>rwa</span><span class=w> </span><span class=o>[</span><span class=n>h</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>h&#39;</span>
<span class=w>    </span><span class=n>contradiction</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>h₂</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>S</span>
<span class=w>  </span><span class=gr>sorry</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=n>h₃</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>j</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>S</span>
<span class=w>  </span><span class=gr>sorry</span>
<span class=w>  </span><span class=n>contradiction</span>
</code></pre></div> <h2 id=the-schroder-bernstein-theorem>The Schröder-Bernstein Theorem<a class=headerlink href=#the-schroder-bernstein-theorem title="Permanent link">&para;</a></h2> <p>We close this chapter with an elementary but nontrivial theorem of set theory. Let <span class=arithmatex>\(\alpha\)</span> and <span class=arithmatex>\(\beta\)</span> be sets. (In our formalization, they will actually be types.) Suppose <span class=arithmatex>\(f : \alpha → \beta\)</span> and <span class=arithmatex>\(g : \beta → \alpha\)</span> are both injective. Intuitively, this means that <span class=arithmatex>\(\alpha\)</span> is no bigger than <span class=arithmatex>\(\beta\)</span> and vice-versa. If <span class=arithmatex>\(\alpha\)</span> and <span class=arithmatex>\(\beta\)</span> are finite, this implies that they have the same cardinality, which is equivalent to saying that there is a bijection between them. In the nineteenth century, Cantor stated that same result holds even in the case where <span class=arithmatex>\(\alpha\)</span> and <span class=arithmatex>\(\beta\)</span> are infinite. This was eventually established by Dedekind, Schröder, and Bernstein independently.</p> <p>Our formalization will introduce some new methods that we will explain in greater detail in chapters to come. Don't worry if they go by too quickly here. Our goal is to show you that you already have the skills to contribute to the formal proof of a real mathematical result.</p> <p>To understand the idea behind the proof, consider the image of the map <span class=arithmatex>\(g\)</span> in <span class=arithmatex>\(\alpha\)</span>. On that image, the inverse of <span class=arithmatex>\(g\)</span> is defined and is a bijection with <span class=arithmatex>\(\beta\)</span>.</p> <p>The problem is that the bijection does not include the shaded region in the diagram, which is nonempty if <span class=arithmatex>\(g\)</span> is not surjective. Alternatively, we can use <span class=arithmatex>\(f\)</span> to map all of <span class=arithmatex>\(\alpha\)</span> to <span class=arithmatex>\(\beta\)</span>, but in that case the problem is that if <span class=arithmatex>\(f\)</span> is not surjective, it will miss some elements of <span class=arithmatex>\(\beta\)</span>.</p> <p>But now consider the composition <span class=arithmatex>\(g \circ f\)</span> from <span class=arithmatex>\(\alpha\)</span> to itself. Because the composition is injective, it forms a bijection between <span class=arithmatex>\(\alpha\)</span> and its image, yielding a scaled-down copy of <span class=arithmatex>\(alpha\)</span> inside itself.</p> <!-- .. image:: /figures/schroeder_bernstein3. --> <p>This composition maps the inner shaded ring to yet another such set, which we can think of as an even smaller concentric shaded ring, and so on. This yields a concentric sequence of shaded rings, each of which is in bijective correspondence with the next. If we map each ring to the next and leave the unshaded parts of <span class=arithmatex>\(\alpha\)</span> alone, we have a bijection of <span class=arithmatex>\(\alpha\)</span> with the image of <span class=arithmatex>\(g\)</span>. Composing with <span class=arithmatex>\(g^{-1}\)</span>, this yields the desired bijection between <span class=arithmatex>\(\alpha\)</span> and <span class=arithmatex>\(\beta\)</span>.</p> <p>We can describe this bijection more simply. Let <span class=arithmatex>\(A\)</span> be the union of the sequence of shaded regions, and define <span class=arithmatex>\(h : \alpha \to \beta\)</span> as follows:</p> <div class=arithmatex>\[ h(x) = \begin{cases} f(x) &amp; \text{if $x \in A$} \\ g^{-1}(x) &amp; \text{otherwise.} \end{cases} \]</div> <p>In other words, we use <span class=arithmatex>\(f\)</span> on the shaded parts, and we use the inverse of <span class=arithmatex>\(g\)</span> everywhere else. The resulting map <span class=arithmatex>\(h\)</span> is injective because each component is injective and the images of the two components are disjoint. To see that it is surjective, suppose we are given a <span class=arithmatex>\(y\)</span> in <span class=arithmatex>\(\beta\)</span>, and consider <span class=arithmatex>\(g(y)\)</span>. If <span class=arithmatex>\(g(y)\)</span> is in one of the shaded regions, it cannot be in the first ring, so we have <span class=arithmatex>\(g(y) = g(f(x))\)</span> for some <span class=arithmatex>\(x\)</span> is in the previous ring. By the injectivity of <span class=arithmatex>\(g\)</span>, we have <span class=arithmatex>\(h(x) = f(x) = y\)</span>. If <span class=arithmatex>\(g(y)\)</span> is not in the shaded region, then by the definition of <span class=arithmatex>\(h\)</span>, we have <span class=arithmatex>\(h(g(y))= y\)</span>. Either way, <span class=arithmatex>\(y\)</span> is in the image of <span class=arithmatex>\(h\)</span>.</p> <p>This argument should sound plausible, but the details are delicate. Formalizing the proof will not only improve our confidence in the result, but also help us understand it better. Because the proof uses classical logic, we tell Lean that our definitions will generally not be computable.</p> <div class=highlight><pre><span></span><code><span class=kd>noncomputable</span><span class=w> </span><span class=kn>section</span>
<span class=kn>open</span><span class=w> </span><span class=n>Classical</span>
<span class=kd>variable</span><span class=w> </span><span class=o>{</span><span class=n>α</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=kt>Type</span><span class=bp>*</span><span class=o>}</span><span class=w> </span><span class=o>[</span><span class=n>Nonempty</span><span class=w> </span><span class=n>β</span><span class=o>]</span>
</code></pre></div> <p>The annotation <code>[Nonempty β]</code> specifies that <code>β</code> is nonempty. We use it because the Mathlib primitive that we will use to construct <span class=arithmatex>\(g^{-1}\)</span> requires it. The case of the theorem where <span class=arithmatex>\(\beta\)</span> is empty is trivial, and even though it would not be hard to generalize the formalization to cover that case as well, we will not bother. Specifically, we need the hypothesis <code>[Nonempty β]</code> for the operation <code>invFun</code> that is defined in Mathlib. Given <code>x : α</code>, <code>invFun g x</code> chooses a preimage of <code>x</code> in <code>β</code> if there is one, and returns an arbitrary element of <code>β</code> otherwise. The function <code>invFun g</code> is always a left inverse if <code>g</code> is injective and a right inverse if <code>g</code> is surjective.</p> <p>We define the set corresponding to the union of the shaded regions as follows.</p> <div class=highlight><pre><span></span><code><span class=kd>variable</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>g</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>α</span><span class=o>)</span>

<span class=kd>def</span><span class=w> </span><span class=n>sbAux</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>ℕ</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>Set</span><span class=w> </span><span class=n>α</span>
<span class=w>  </span><span class=bp>|</span><span class=w> </span><span class=mi>0</span><span class=w> </span><span class=bp>=&gt;</span><span class=w> </span><span class=n>univ</span><span class=w> </span><span class=bp>\</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>univ</span>
<span class=w>  </span><span class=bp>|</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>+</span><span class=w> </span><span class=mi>1</span><span class=w> </span><span class=bp>=&gt;</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>sbAux</span><span class=w> </span><span class=n>n</span><span class=o>)</span>

<span class=kd>def</span><span class=w> </span><span class=n>sbSet</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=bp>⋃</span><span class=w> </span><span class=n>n</span><span class=o>,</span><span class=w> </span><span class=n>sbAux</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>n</span>
</code></pre></div> <p>The definition <code>sbAux</code> is an example of a <em>recursive definition</em>, which we will explain in the next chapter. It defines a sequence of sets</p> <div class=arithmatex>\[ S*0 &amp;= \alpha ∖ g(\beta) \\ S*{n+1} &amp;= g(f(S_n)). \]</div> <p>The definition <code>sbSet</code> corresponds to the set <span class=arithmatex>\(A = \bigcup_{n \in \mathbb{N}} S_n\)</span> in our proof sketch. The function <span class=arithmatex>\(h\)</span> described above is now defined as follows:</p> <div class=highlight><pre><span></span><code><span class=kd>def</span><span class=w> </span><span class=n>sbFun</span><span class=w> </span><span class=o>(</span><span class=n>x</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=k>if</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>sbSet</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=k>then</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=n>invFun</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>x</span>
</code></pre></div> <p>We will need the fact that our definition of <span class=arithmatex>\(g^{-1}\)</span> is a right inverse on the complement of <span class=arithmatex>\(A\)</span>, which is to say, on the non-shaded regions of <span class=arithmatex>\(\alpha\)</span>. This is so because the outermost ring, <span class=arithmatex>\(S_0\)</span>, is equal to <span class=arithmatex>\(\alpha \setminus g(\beta)\)</span>, so the complement of <span class=arithmatex>\(A\)</span> is contained in <span class=arithmatex>\(g(\beta)\)</span>. As a result, for every <span class=arithmatex>\(x\)</span> in the complement of <span class=arithmatex>\(A\)</span>, there is a <span class=arithmatex>\(y\)</span> such that <span class=arithmatex>\(g(y) = x\)</span>. (By the injectivity of <span class=arithmatex>\(g\)</span>, this <span class=arithmatex>\(y\)</span> is unique, but next theorem says only that <code>invFun g x</code> returns some <code>y</code> such that <code>g y = x</code>.)</p> <p>Step through the proof below, make sure you understand what is going on, and fill in the remaining parts. You will need to use <code>invFun_eq</code> at the end. Notice that rewriting with <code>sbAux</code> here replaces <code>sbAux f g 0</code> with the right-hand side of the corresponding defining equation.</p> <div class=highlight><pre><span></span><code><span class=kd>theorem</span><span class=w> </span><span class=n>sb</span><span class=bp>*</span><span class=n>right_inv</span><span class=w> </span><span class=o>{</span><span class=n>x</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=o>}</span><span class=w> </span><span class=o>(</span><span class=n>hx</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>sbSet</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>(</span><span class=n>invFun</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>x</span><span class=o>)</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=bp>&#39;&#39;</span><span class=w> </span><span class=n>univ</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>    </span><span class=n>contrapose</span><span class=bp>!</span><span class=w> </span><span class=n>hx</span>
<span class=w>    </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>sbSet</span><span class=o>,</span><span class=w> </span><span class=n>mem_iUnion</span><span class=o>]</span>
<span class=w>    </span><span class=n>use</span><span class=w> </span><span class=mi>0</span>
<span class=w>    </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>sbAux</span><span class=o>,</span><span class=w> </span><span class=n>mem_diff</span><span class=o>]</span>
<span class=w>    </span><span class=gr>sorry</span>
<span class=w>  </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>mem_univ</span><span class=w> </span><span class=bp>*</span><span class=o>,</span><span class=w> </span><span class=n>hx</span><span class=o>⟩</span>
<span class=w>  </span><span class=k>have</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=bp>∃</span><span class=w> </span><span class=n>y</span><span class=o>,</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>    </span><span class=gr>sorry</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>We now turn to the proof that <span class=arithmatex>\(h\)</span> is injective. Informally, the proof goes as follows. First, suppose <span class=arithmatex>\(h(x_1) = h(x_2)\)</span>. If <span class=arithmatex>\(x_1\)</span> is in <span class=arithmatex>\(A\)</span>, then <span class=arithmatex>\(h(x_1) = f(x_1)\)</span>, and we can show that <span class=arithmatex>\(x_2\)</span> is in <span class=arithmatex>\(A\)</span> as follows. If it isn't, then we have <span class=arithmatex>\(h(x_2) = g^{-1}(x_2)\)</span>. From <span class=arithmatex>\(f(x_1) = h(x_1) = h(x_2)\)</span> we have <span class=arithmatex>\(g(f(x_1)) = x_2\)</span>. From the definition of <span class=arithmatex>\(A\)</span>, since <span class=arithmatex>\(x_1\)</span> is in <span class=arithmatex>\(A\)</span>, <span class=arithmatex>\(x_2\)</span> is in <span class=arithmatex>\(A\)</span> as well, a contradiction. Hence, if $x_1` is in <span class=arithmatex>\(A\)</span>, so is <span class=arithmatex>\(x_2\)</span>, in which case we have <span class=arithmatex>\(f(x_1) = h(x_1) = h(x_2) = f(x_2)\)</span>. The injectivity of <span class=arithmatex>\(f\)</span> then implies <span class=arithmatex>\(x_1 = x_2\)</span>. The symmetric argument shows that if <span class=arithmatex>\(x_2\)</span> is in <span class=arithmatex>\(A\)</span>, then so is <span class=arithmatex>\(x_1\)</span>, which again implies <span class=arithmatex>\(x_1 = x_2\)</span>.</p> <p>The only remaining possibility is that neither <span class=arithmatex>\(x_1\)</span> nor <span class=arithmatex>\(x_2\)</span> is in <span class=arithmatex>\(A\)</span>. In that case, we have <span class=arithmatex>\(g^{-1}(x_1) = h(x_1) = h(x_2) = g^{-1}(x_2)\)</span>. Applying <span class=arithmatex>\(g\)</span> to both sides yields <span class=arithmatex>\(x_1 = x_2\)</span>.</p> <p>Once again, we encourage you to step through the following proof to see how the argument plays out in Lean. See if you can finish off the proof using <code>sb_right_inv</code>.</p> <div class=highlight><pre><span></span><code><span class=kd>theorem</span><span class=w> </span><span class=n>sb</span><span class=bp>*</span><span class=n>injective</span><span class=w> </span><span class=o>(</span><span class=n>hf</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=o>(</span><span class=n>sbFun</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>sbSet</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>A_def</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>sbFun</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>h_def</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=n>x₂</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=o>(</span><span class=n>hxeq</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=n>x₂</span><span class=o>)</span>
<span class=w>  </span><span class=k>show</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>x₂</span>
<span class=w>  </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>h_def</span><span class=o>,</span><span class=w> </span><span class=n>sbFun</span><span class=o>,</span><span class=w> </span><span class=bp>←</span><span class=w> </span><span class=n>A_def</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>hxeq</span>
<span class=w>  </span><span class=n>by_cases</span><span class=w> </span><span class=n>xA</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=bp>∨</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>A</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>wlog</span><span class=w> </span><span class=n>x₁A</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=n>generalizing</span><span class=w> </span><span class=n>x₁</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=n>hxeq</span><span class=w> </span><span class=n>xA</span>
<span class=w>    </span><span class=bp>·</span><span class=w> </span><span class=n>symm</span>
<span class=w>      </span><span class=n>apply</span><span class=w> </span><span class=n>this</span><span class=w> </span><span class=n>hxeq.symm</span><span class=w> </span><span class=n>xA.symm</span><span class=w> </span><span class=o>(</span><span class=n>xA.resolve_left</span><span class=w> </span><span class=n>x₁A</span><span class=o>)</span>
<span class=w>    </span><span class=k>have</span><span class=w> </span><span class=n>x₂A</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>      </span><span class=n>apply</span><span class=w> </span><span class=bp>\</span><span class=n>_root</span><span class=bp>*.</span><span class=n>not_imp_self.mp</span>
<span class=w>      </span><span class=n>intro</span><span class=w> </span><span class=o>(</span><span class=n>x₂nA</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=bp>∉</span><span class=w> </span><span class=n>A</span><span class=o>)</span>
<span class=w>      </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>if_pos</span><span class=w> </span><span class=n>x₁A</span><span class=o>,</span><span class=w> </span><span class=n>if_neg</span><span class=w> </span><span class=n>x₂nA</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>hxeq</span>
<span class=w>      </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>A_def</span><span class=o>,</span><span class=w> </span><span class=n>sbSet</span><span class=o>,</span><span class=w> </span><span class=n>mem_iUnion</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>x₁A</span>
<span class=w>      </span><span class=k>have</span><span class=w> </span><span class=n>x₂eq</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x₂</span><span class=w> </span><span class=bp>=</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=o>(</span><span class=n>f</span><span class=w> </span><span class=n>x₁</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>        </span><span class=gr>sorry</span>
<span class=w>      </span><span class=n>rcases</span><span class=w> </span><span class=n>x₁A</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=o>⟨</span><span class=n>n</span><span class=o>,</span><span class=w> </span><span class=n>hn</span><span class=o>⟩</span>
<span class=w>      </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>A_def</span><span class=o>,</span><span class=w> </span><span class=n>sbSet</span><span class=o>,</span><span class=w> </span><span class=n>mem_iUnion</span><span class=o>]</span>
<span class=w>      </span><span class=n>use</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=bp>+</span><span class=w> </span><span class=mi>1</span>
<span class=w>      </span><span class=n>simp</span><span class=w> </span><span class=o>[</span><span class=n>sbAux</span><span class=o>]</span>
<span class=w>      </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>x₁</span><span class=o>,</span><span class=w> </span><span class=n>hn</span><span class=o>,</span><span class=w> </span><span class=n>x₂eq.symm</span><span class=o>⟩</span>
<span class=w>    </span><span class=gr>sorry</span>
<span class=w>  </span><span class=n>push_neg</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>xA</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>The proof introduces some new tactics. To start with, notice the <code>set</code> tactic, which introduces abbreviations <code>A</code> and <code>h</code> for <code>sbSet f g</code> and <code>sb_fun f g</code> respectively. We name the corresponding defining equations <code>A_def</code> and <code>h_def</code>. The abbreviations are definitional, which is to say, Lean will sometimes unfold them automatically when needed. But not always; for example, when using <code>rw</code>, we generally need to use <code>A_def</code> and <code>h_def</code> explicitly. So the definitions bring a tradeoff: they can make expressions shorter and more readable, but they sometimes require us to do more work.</p> <p>A more interesting tactic is the <code>wlog</code> tactic, which encapsulates the symmetry argument in the informal proof above. We will not dwell on it now, but notice that it does exactly what we want. If you hover over the tactic you can take a look at its documentation.</p> <p>The argument for surjectivity is even easier. Given <span class=arithmatex>\(y\)</span> in <span class=arithmatex>\(\beta\)</span>, we consider two cases, depending on whether <span class=arithmatex>\(g(y)\)</span> is in <span class=arithmatex>\(A\)</span>. If it is, it can't be in <span class=arithmatex>\(S_0\)</span>, the outermost ring, because by definition that is disjoint from the image of <span class=arithmatex>\(g\)</span>. Thus it is an element of <span class=arithmatex>\(S_{n+1}\)</span> for some <span class=arithmatex>\(n\)</span>. This means that it is of the form <span class=arithmatex>\(g(f(x))\)</span> for some <span class=arithmatex>\(x\)</span> in <span class=arithmatex>\(S_n\)</span>. By the injectivity of <span class=arithmatex>\(g\)</span>, we have <span class=arithmatex>\(f(x) = y\)</span>. In the case where <span class=arithmatex>\(g(y)\)</span> is in the complement of <span class=arithmatex>\(A\)</span>, we immediately have <span class=arithmatex>\(h(g(y))= y\)</span>, and we are done.</p> <p>Once again, we encourage you to step through the proof and fill in the missing parts. The tactic <code>rcases n with _ | n</code> splits on the cases <code>g y ∈ sbAux f g 0</code> and <code>g y ∈ sbAux f g (n + 1)</code>. In both cases, calling the simplifier with <code>simp [sbAux]</code> applies the corresponding defining equation of <code>sbAux</code>.</p> <div class=highlight><pre><span></span><code><span class=kd>theorem</span><span class=w> </span><span class=n>sb_surjective</span><span class=w> </span><span class=o>(</span><span class=n>hg</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>g</span><span class=o>)</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Surjective</span><span class=w> </span><span class=o>(</span><span class=n>sbFun</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=o>)</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>sbSet</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>A_def</span>
<span class=w>  </span><span class=n>set</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=n>sbFun</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=n>h_def</span>
<span class=w>  </span><span class=n>intro</span><span class=w> </span><span class=n>y</span>
<span class=w>  </span><span class=n>by_cases</span><span class=w> </span><span class=n>gyA</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>y</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>A</span>
<span class=w>  </span><span class=bp>·</span><span class=w> </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>A_def</span><span class=o>,</span><span class=w> </span><span class=n>sbSet</span><span class=o>,</span><span class=w> </span><span class=n>mem_iUnion</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>gyA</span>
<span class=w>    </span><span class=n>rcases</span><span class=w> </span><span class=n>gyA</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=o>⟨</span><span class=n>n</span><span class=o>,</span><span class=w> </span><span class=n>hn</span><span class=o>⟩</span>
<span class=w>    </span><span class=n>rcases</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=bp>*</span><span class=w> </span><span class=bp>|</span><span class=w> </span><span class=n>n</span>
<span class=w>    </span><span class=bp>·</span><span class=w> </span><span class=n>simp</span><span class=w> </span><span class=o>[</span><span class=n>sbAux</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>hn</span>
<span class=w>    </span><span class=n>simp</span><span class=w> </span><span class=o>[</span><span class=n>sbAux</span><span class=o>]</span><span class=w> </span><span class=n>at</span><span class=w> </span><span class=n>hn</span>
<span class=w>    </span><span class=n>rcases</span><span class=w> </span><span class=n>hn</span><span class=w> </span><span class=k>with</span><span class=w> </span><span class=o>⟨</span><span class=n>x</span><span class=o>,</span><span class=w> </span><span class=n>xmem</span><span class=o>,</span><span class=w> </span><span class=n>hx</span><span class=o>⟩</span>
<span class=w>    </span><span class=n>use</span><span class=w> </span><span class=n>x</span>
<span class=w>    </span><span class=k>have</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>x</span><span class=w> </span><span class=bp>∈</span><span class=w> </span><span class=n>A</span><span class=w> </span><span class=o>:=</span><span class=w> </span><span class=kd>by</span>
<span class=w>      </span><span class=n>rw</span><span class=w> </span><span class=o>[</span><span class=n>A_def</span><span class=o>,</span><span class=w> </span><span class=n>sbSet</span><span class=o>,</span><span class=w> </span><span class=n>mem_iUnion</span><span class=o>]</span>
<span class=w>      </span><span class=n>exact</span><span class=w> </span><span class=o>⟨</span><span class=n>n</span><span class=o>,</span><span class=w> </span><span class=n>xmem</span><span class=o>⟩</span>
<span class=w>    </span><span class=n>simp</span><span class=w> </span><span class=n>only</span><span class=w> </span><span class=o>[</span><span class=n>h_def</span><span class=o>,</span><span class=w> </span><span class=n>sbFun</span><span class=o>,</span><span class=w> </span><span class=n>if_pos</span><span class=w> </span><span class=n>this</span><span class=o>]</span>
<span class=w>    </span><span class=n>exact</span><span class=w> </span><span class=n>hg</span><span class=w> </span><span class=n>hx</span>
<span class=w>  </span><span class=gr>sorry</span>
</code></pre></div> <p>We can now put it all together. The final statement is short and sweet, and the proof uses the fact that <code>Bijective h</code> unfolds to <code>Injective h ∧ Surjective h</code>.</p> <div class=highlight><pre><span></span><code><span class=kd>theorem</span><span class=w> </span><span class=n>schroeder_bernstein</span><span class=w> </span><span class=o>{</span><span class=n>f</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>}</span><span class=w> </span><span class=o>{</span><span class=n>g</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>β</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>α</span><span class=o>}</span><span class=w> </span><span class=o>(</span><span class=n>hf</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>f</span><span class=o>)</span><span class=w> </span><span class=o>(</span><span class=n>hg</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>Injective</span><span class=w> </span><span class=n>g</span><span class=o>)</span><span class=w> </span><span class=o>:</span>
<span class=w>  </span><span class=bp>∃</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>:</span><span class=w> </span><span class=n>α</span><span class=w> </span><span class=bp>→</span><span class=w> </span><span class=n>β</span><span class=o>,</span><span class=w> </span><span class=n>Bijective</span><span class=w> </span><span class=n>h</span><span class=w> </span><span class=o>:=</span>
<span class=w>  </span><span class=o>⟨</span><span class=n>sbFun</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=o>,</span><span class=w> </span><span class=n>sb_injective</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>hf</span><span class=o>,</span><span class=w> </span><span class=n>sb_surjective</span><span class=w> </span><span class=n>f</span><span class=w> </span><span class=n>g</span><span class=w> </span><span class=n>hg</span><span class=o>⟩</span>
</code></pre></div> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.tabs", "navigation.sections", "navigation.instant", "search.highlight", "search.share", "content.code.copy", "content.code.annotate"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"alias": true, "default": "latest", "provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.fe8b6f2b.min.js></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script> </body> </html>